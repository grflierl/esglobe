<!DOCTYPE html>
<html ng-app='app-esrl'>
  <base href="/esglobe/esglobe_modules/climatology/" />
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel='stylesheet' href='./css/app.css' />

    <script src="../../js/vendor/jquery/dist/jquery.js"></script>
    <script src="../../js/vendor/jquery-validation/dist/jquery.validate.js"></script>
    <script src="../../js/vendor/lodash/lodash.js"></script>
    <script src="../../js/vendor/bootstrap/dist/js/bootstrap.js"></script>
    <script src="../../js/vendor/handlebars/dist/handlebars.js"></script>

    <!-- Angular Scripts --->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-resource/1.5.6/angular-resource.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.0/ui-bootstrap.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.0/ui-bootstrap-tpls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.6/angular-animate.min.js"></script>

    <!-- angular boostrap toggle -->
    <link href="./js/angular-bootstrap-toggle/dist/angular-bootstrap-toggle.min.css" rel="stylesheet">
    <script src="./js/angular-bootstrap-toggle/dist/angular-bootstrap-toggle.min.js"></script>
    
    <script src="../../js/formBuilder.js"></script>
    <script src="../../js/esmodule.js"></script>
    <script src="../../js/emitter.js"></script>
    <script src="../../js/sph-es.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel='stylesheet' href='./css/app.css' />

    <script src="js/Resources/defaults.js"></script>
    <script src="js/Resources/esrl.js"></script>
    <script src="js/esrl.js"></script>

    <script src="js/index.js"></script>

    <style>
      body {
        background-image: none !important;
        background-color: transparent !important;
      }
    </style>
  </head>
  <body ng-controller="EsrlChildController">
  <div class="row gutter">
    <div class="col-xs-12">
      <h2 style="margin-top:8px; text-align: center; ">Atmospheric Climatology from ESRL</h2>
    </div>
  </div>
  <form name="esrlForm">
    <fieldset ng-disabled="isLoading">
      <div class="row gutter">
        <div class="col-xs-12">
          <div class="row" ng-if="section.filename">
            <!-- Section plot image -->
            <div class="col-xs-12">
              <a href="#" ng-click="openLightboxModal(section.filename)">
                <img style='width:654px; padding: 0;'; ng-src="{{section.filepath}}{{section.filename}}" err-src="/images/placeholder.jpg">
              </a>
              <span class="level-indicator">
                  <a class="level-up link" ng-click="levelUp()"><span class="glyphicon glyphicon-chevron-up"></span></a>
                  <a class="level-down link" ng-click="levelDown()"><span class="glyphicon glyphicon-chevron-down"></span></a>
              </span>
            </div>
          </div>
          <div class="row padding" ng-if="section.filename">
            <div class="col-xs-12">
              <a ng-if="!section.input.field2" href="./backend/download_image.php?filename={{section.filename}}" download="{{section.input.field}}-{{section.input.time}}-{{section.input.press}}-lon{{section.input.lon}}.png">Download Image |</a>
              <a ng-if="section.input.field2" href="./backend/download_image.php?filename={{section.filename}}" download="{{section.input.field}}-{{section.input.field2}}-{{section.input.time}}-{{section.input.press}}-lon{{section.input.lon}}.png">Download Image |</a>

              <a href="#" ng-click="downloadSectionData()">Download Section Data</a> |
              <a href="#" ng-click="downloadGlobeData()">Download Globe Data</a>
            </div>
          </div>


          <div class="row">
            <div class="col-xs-2">
              <div class="form-group">
                <label>Month</label>
                <select class="form-control sm"
                        ng-options="time as time for time in data.timeArr"
                        ng-model="section.input.time" ng-model-options="{debounce:500}">
                </select>
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>Pressure Range</label>
                <select ng-model="section.input.press" class="form-control sm">
                  <option value=1>Upper Stratosphere (10-100)</option>
                  <option value=10>Stratosphere (10-500)</option>
                  <option value=100>Troposphere (100-1000)</option>
                  <option value=500>Surface (500-1000)</option>
                </select>
                <!--<input type='number' min=0 max=1000 step=1 class="form-control sm" ng-model="section.input.press" ng-model-options="{debounce:500}" required>-->
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group">
                <label>Lon</label>
                <input ng-model="section.input.lon" ng-model-options="{debounce:500}" class="form-control sm" type="number" min="-180" max="180" step="1" required>
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group sm">
                <label class="block">Log Scale</label>
                <toggle type='checkbox' ng-model="section.input.logScale"></toggle>
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group sm">
                <label class="block">Zonal</label>
                <toggle type='checkbox' ng-model="section.input.zonalAverage"></toggle>
              </div>
            </div>
            <!--<div class="col-xs-2">
                <div class="form-group">
                    <label>Fill Contour</label>
                    <toggle type='checkbox' ng-model="section.input.fillContour"></toggle>
                </div>
            </div>-->
          </div>
          <div class="row">
            <div class="col-xs-4">
              <div class="form-group">
                <label>Field</label>
                <select class="form-control sm" name="field" id="field" ng-model="section.input.field" ng-model-options="{debounce:500}">
                  <option value='{{key}}' ng-repeat="(key, val) in data.fields">{{val}}</option>
                  <!--<option selected value="pottmp">Potential Temperature</option>
                  <option value="hgt">Geopotential Height</option>
                  <option value="uwnd">U-wind</option>
                  <option value="vwnd">V-wind</option>
                  <option value="omega">Omega</option>
                  <option value="air">Air Temperature</option>-->
                </select>
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>Second Field <span ng-if="section.input.field2">(<a href="#" ng-click="section.input.field2=null">clear</a>)</span></label>
                <select class="form-control sm" name="field2" id="field2" ng-model="section.input.field2" ng-model-options="{debounce:500}">
                  <option value='{{key}}' ng-repeat="(key, val) in data.fields">{{val}}</option>
                </select>
              </div>
            </div>
            <div class="col-xs-3">
              <div class="form-group">
                <label class="block">Settings</label>
                <button class="btn btn-default btn-sm" ng-click="openSettingsModal()">
                  <span class="fa fa-gear"></span>
                </button>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12">
              <button class="btn btn-primary btn-sm" ng-click="section.submit()" ng-disabled="isLoading">Show Section <span ng-show="isLoading" class="fa fa-spin fa-spinner"></span></button>
              <button class="btn btn-default btn-sm"
                      ng-click="toggleKeyboardControl()"
                      ng-class="{'btn-default': !section.flags.keyboardControl, 'btn-success': section.flags.keyboardControl}">
                Toggle Keyboard Control (<span ng-if="section.flags.keyboardControl">On</span><span ng-if="!section.flags.keyboardControl">Off</span>)
              </button>
              <span ng-if="section.flags.keyboardControl">
                <span class="fa fa-arrow-left"></span> <span class="fa fa-arrow-right"></span> Time Step &nbsp;&nbsp;
                <span class="fa fa-arrow-up"></span> <span class="fa fa-arrow-down"></span> Level Step
              </span>
            </div>
          </div>
        </div>
      </div>
    </fieldset>
    <div class="modal-parent">
    </div>
  </form>

  <!--- ESRL additional parameters input Modal ---->
  <script type="text/ng-template" id="sectionSettingsModal.html">
    <form ng-submit="ctrl.ok()">
      <div class="modal-body" id="modal-body">
        <h3 Section>Field 1: {{ctrl.input.field}}</h3>
        <div class="row">
          <div class="col-xs-6">
            <div class="form-group">
              <label for="contourDensity">Contour Step</label>
              <input class="form-control" id="contourStep" ng-model="ctrl.input.contour" ng-model-options="{debounce: 500}" required>
            </div>
          </div>
        </div>
        <h3 ng-if="ctrl.input.field2">Section Field 2: {{ctrl.input.field2}}</h3>
        <div class="row" ng-if="ctrl.input.field2">
          <div class="col-xs-6">
            <div class="form-group">
              <label for="contourStep">Contour Step</label>
              <input class="form-control" id="contourStep2" ng-model="ctrl.input.contour2" ng-model-options="{debounce: 500}" required>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer" id="modal-footer">
        <input type="button" class="btn btn-default pull-left" ng-click="ctrl.resetDefaults()" value="Reset Defaults">
        <input type="submit" class="btn btn-primary" value="Save">
        <input type="button" class="btn btn-default" ng-click="ctrl.cancel()" value="Cancel">
      </div>
    </form>
  </script>

  <!--- Globe Settings Modal ---->
  <script type="text/ng-template" id="globeSettingsModal.html">
    <form ng-submit="ctrl.ok()">
      <div class="modal-body" id="modal-body">
        <h3 Section>Globe Field: {{ctrl.input.globe.field}}</h3>
        <div class="row">
          <div class="col-xs-6">
            <div class="form-group">
              <label for="contourDensity">Contour Step</label>
              <input class="form-control" id="contourStep" ng-model="ctrl.input.globe.contourStep" ng-model-options="{debounce: 500}" required>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer" id="modal-footer">
        <input type="button" class="btn btn-default pull-left" ng-click="ctrl.resetDefaults()" value="Reset Defaults">
        <input type="submit" class="btn btn-primary" value="Save">
        <input type="button" class="btn btn-default" ng-click="ctrl.cancel()" value="Cancel">
      </div>
    </form>
  </script>

  <!--- Lightbox Modal --->
  <script type='text/x-handlebars-template' id="lightboxModal">
    <div class="modal-body" id="modal-body">
      <img style='width:100%; padding:0; margin-top: 0px'; src="{{filename}}">
      <p style="text-align:center">
        {{#if input.field2}}
          <a href="{{filename}}" download="{{input.field}}-{{input.time}}-{{input.press}}-lon{{input.lon}}.png">Download file</a>
        {{else}}
          <a href="{{filename}}" download="{{input.field}}-{{input.field2}}-{{input.time}}-{{input.press}}-lon{{input.lon}}.png">Download file</a>
        {{/if}}
      </p>
    </div>
  </script>

  </body>
</html>




